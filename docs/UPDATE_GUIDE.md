# 应用更新功能使用指南

本应用已集成了自动更新功能，用户可以方便地检查、下载和安装应用更新。

## 功能特性

- ✅ 自动检查更新
- ✅ 在线下载更新包
- ✅ 实时显示下载进度
- ✅ 一键安装更新
- ✅ 支持增量更新
- ✅ 更新失败重试机制

## 如何使用

### 1. 检查更新

1. 打开应用设置页面
2. 找到 **应用更新** 部分
3. 点击 **检查更新** 按钮
4. 系统会自动检查是否有新版本

### 2. 下载更新

当检测到新版本时：

1. 系统会显示新版本信息
2. 点击 **下载更新** 按钮开始下载
3. 下载过程中会显示实时进度
4. 可以查看下载速度和剩余时间

### 3. 安装更新

下载完成后：

1. 系统会提示更新已就绪
2. 点击 **立即重启** 安装更新
3. 应用会自动重启并完成更新

## 开发者配置

### 1. 发布设置

在 `electron-builder.json5` 中配置发布信息：

```json5
{
  publish: {
    provider: "github",
    owner: "your-github-username",
    repo: "your-repo-name",
  },
}
```

### 2. 构建和发布

```bash
# 构建应用（仅打包）
npm run build

# 构建并发布更新
npm run build:publish
```

### 3. GitHub Release

1. 在 GitHub 上创建新的 Release
2. 上传构建产物
3. 设置版本号（遵循语义化版本）
4. 发布 Release

### 4. 环境变量

发布时需要设置 GitHub Token：

```bash
export GH_TOKEN="your-github-token"
npm run build:publish
```

## 更新服务器

### GitHub Releases（推荐）

- 免费使用
- 自动生成更新元数据
- 支持多平台
- CDN 分发

### 自建服务器

如果需要自建更新服务器，需要：

1. 实现更新 API 端点
2. 提供版本检查接口
3. 支持文件下载
4. 生成更新元数据

## 版本管理

### 版本号格式

使用语义化版本（Semantic Versioning）：

- `1.0.0` - 主版本.次版本.修订版本
- `1.0.1` - 修复版本
- `1.1.0` - 功能版本
- `2.0.0` - 重大版本

### 更新策略

- **补丁更新**：自动下载安装
- **次版本更新**：提示用户选择
- **主版本更新**：显著提示并说明变更

## 常见问题

### Q: 更新检查失败怎么办？

A: 检查网络连接，确认发布服务器可访问。

### Q: 下载速度很慢？

A: 这取决于网络环境和服务器位置，可以稍后重试。

### Q: 更新安装失败？

A: 确保应用有足够的写入权限，关闭杀毒软件重试。

### Q: 如何禁用自动更新？

A: 目前不支持禁用，但会在后续版本中添加此功能。

## 技术架构

### 主进程（Main Process）

- `updateHandler.ts` - 更新逻辑处理
- 使用 `electron-updater` 库
- 监听更新事件并通知渲染进程

### 渲染进程（Renderer Process）

- `AppUpdater.vue` - 更新界面组件
- 通过 IPC 与主进程通信
- 实时显示更新状态

### 通信机制

- 检查更新：`app:check-for-updates`
- 下载更新：`app:download-update`
- 安装更新：`app:install-update`
- 获取版本：`app:get-version`

## 安全考虑

- ✅ 验证更新包签名
- ✅ HTTPS 传输加密
- ✅ 文件完整性校验
- ✅ 权限最小化原则

## 平台支持

- ✅ Windows (NSIS installer)
- ✅ macOS (DMG)
- ✅ Linux (AppImage)

每个平台都有对应的更新机制和安装包格式。
